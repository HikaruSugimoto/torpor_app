
<!DOCTYPE html>
<html>
<head>
    <title>Differentially regulated metabolites</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .plot-container {
            width: 100%;
            height: 600px;
        }
        .search-container {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }
        #gene-search {
            padding: 8px;
            width: 250px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .selector-container {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            margin-top: 10px;
        }
        #gene-selector {
            padding: 8px;
            width: 280px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        #search-results {
            margin-top: 10px;
            font-size: 14px;
            width: 100%;
        }
        .filter-container {
            margin-bottom: 20px;
        }
        .checkbox-group {
            display: flex;
            gap: 20px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
        }
        label {
            margin-left: 5px;
        }
        h3 {
            margin: 15px 0 10px 0;
        }
        .control-panel {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
        .info-box {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f5f5f5;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Differentially regulated metabolites</h1>

    <div class="control-panel">
        <div class="search-container">
            <input type="text" id="gene-search" placeholder="Search for metabolites name...">
            <button onclick="searchGene()">Search</button>
            <button onclick="resetView()">Reset</button>
        </div>

        <div class="selector-container">
            <label for="gene-selector">Select metabolites: </label>
            <select id="gene-selector" onchange="selectGene(this.value)">
                <option value="">-- Select a metabolites --</option>
                <!-- Gene options will be populated by JavaScript -->
            </select>
        </div>

        <div id="search-results"></div>

        <div class="filter-container">
            <h3>Select categories to display:</h3>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-all" checked onchange="updateFilters()">
                    <label for="filter-all">All metabolites</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-up" checked onchange="updateFilters()">
                    <label for="filter-up">Upregulated metabolites</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-down" checked onchange="updateFilters()">
                    <label for="filter-down">Downregulated metabolites</label>
                </div>
            </div>
        </div>

        <div class="info-box">
            <p><strong>Tip:</strong> Click on any data point to display its metabolites name. Click anywhere else on the plot to clear annotations. Search results will automatically be highlighted with arrows.</p>
        </div>
    </div>

    <div id="plotly-div" class="plot-container"></div>

    <script>
        // Prepare data
        var allData = [{"x": 0.24943051052935974, "y": 2.453284270112753, "text": "G1P", "category": "All"}, {"x": 0.1201270163645736, "y": 0.647600379270242, "text": "G6P", "category": "All"}, {"x": -0.25311451606380564, "y": 1.1607135935604267, "text": "F6P", "category": "All"}, {"x": -0.2082579133041188, "y": 1.2438003221271747, "text": "F1,6P", "category": "All"}, {"x": 0.02268746676027969, "y": 0.06823999293455038, "text": "DHAP", "category": "All"}, {"x": -0.11474829189607468, "y": 0.6118607815564852, "text": "Glycerophosphate", "category": "All"}, {"x": 0.32004744079979863, "y": 1.5351510936826138, "text": "2,3-DPG", "category": "All"}, {"x": 0.40766081372749957, "y": 2.6076729699488026, "text": "3PG", "category": "All"}, {"x": 0.08640905827736176, "y": 0.20418777818896455, "text": "2PG", "category": "All"}, {"x": 0.47308326168622755, "y": 2.568273349476041, "text": "PEP", "category": "All"}, {"x": -0.16967329746156604, "y": 0.9339794667771147, "text": "Pyruvate", "category": "All"}, {"x": -0.36503884058404573, "y": 2.5409715371860067, "text": "Lactate", "category": "All"}, {"x": 0.36508007862129094, "y": 2.039832621037868, "text": "Acetyl CoA", "category": "All"}, {"x": -0.47097849050548535, "y": 2.667302454673457, "text": "Citrate", "category": "All"}, {"x": -0.37397262773901424, "y": 1.8052144267199037, "text": "cis-Aconitate", "category": "All"}, {"x": -0.05354834239917591, "y": 0.22494859200095088, "text": "Isocitrate", "category": "All"}, {"x": -1.2836476153994187, "y": 1.0127480315154158, "text": "2-Oxoglutarate", "category": "All"}, {"x": 0.03790145940555367, "y": 0.11789361622987861, "text": "2-Hydroxyglutarate", "category": "All"}, {"x": -0.21827090478881817, "y": 1.2715593190709413, "text": "Succinate", "category": "All"}, {"x": -0.44342783139017483, "y": 1.4362508620338097, "text": "Fumarate", "category": "All"}, {"x": -0.40173882302845687, "y": 1.5748132072971026, "text": "Malate", "category": "All"}, {"x": 0.10227250303684224, "y": 0.34497870790149276, "text": "6-Phosphogluconate", "category": "All"}, {"x": -0.03544875518465941, "y": 0.17062135996697483, "text": "Ru5P", "category": "All"}, {"x": 0.18093765098977774, "y": 0.26620794700573264, "text": "R5P", "category": "All"}, {"x": 0.04486597728672741, "y": 0.2425873385023781, "text": "S7P", "category": "All"}, {"x": 0.15167589061789818, "y": 0.7680868249431232, "text": "Glyoxylate", "category": "All"}, {"x": -0.09562265873758077, "y": 0.9547169272757301, "text": "Glycolate", "category": "All"}, {"x": 0.03168296970526616, "y": 0.0926931953069864, "text": "Methanesulfonate", "category": "All"}, {"x": 0.5301642865760143, "y": 2.5871923237560126, "text": "Malonate", "category": "All"}, {"x": 0.7967715214748311, "y": 5.114073660198569, "text": "2-Hydroxyisobutyrate", "category": "All"}, {"x": 1.3173614589259295, "y": 2.2373101102601876, "text": "2-Hydroxybutyrate", "category": "All"}, {"x": 1.806187504534275, "y": 3.342339043758982, "text": "3-Hydroxybutyrate", "category": "All"}, {"x": 0.46238486801747863, "y": 2.6547315716583246, "text": "Hexanoate", "category": "All"}, {"x": 0.5927667273593937, "y": 2.9880187145344226, "text": "Isethionate", "category": "All"}, {"x": -0.43088339822332733, "y": 1.486087099819787, "text": "5-Oxoproline", "category": "All"}, {"x": 0.5922538781072533, "y": 3.1895933957384335, "text": "Glutarate", "category": "All"}, {"x": 0.11862964748349374, "y": 0.7725301070967698, "text": "Threonate", "category": "All"}, {"x": 0.2582231373856632, "y": 2.6190281427060973, "text": "Ethanolamine phosphate", "category": "All"}, {"x": 0.8387458382373921, "y": 3.0130259405957247, "text": "Citramalate", "category": "All"}, {"x": 0.035877296509765164, "y": 0.1994713996874111, "text": "Tartrate", "category": "All"}, {"x": -0.3990486960309522, "y": 2.033197984525177, "text": "Cysteine sulfinate", "category": "All"}, {"x": 0.4035976990450824, "y": 1.9838096755880816, "text": "Pelargonate", "category": "All"}, {"x": 0.9805804221995871, "y": 3.8817220435109245, "text": "3-Hydroxy-3-methylglutarate", "category": "All"}, {"x": -1.3744180380985593, "y": 6.782516055786093, "text": "3-(4-Hydroxyphenyl)propionate", "category": "All"}, {"x": -0.7802892291281919, "y": 1.8217223981810846, "text": "Urate", "category": "All"}, {"x": -0.6593265921933185, "y": 5.09312646527793, "text": "Cysteate", "category": "All"}, {"x": -1.4469233761934235, "y": 3.6546596025764764, "text": "N-Acetylleucine", "category": "All"}, {"x": 0.07773891361191702, "y": 0.3752484988824523, "text": "N-Acetylaspartate", "category": "All"}, {"x": 0.5162071014547421, "y": 1.227834902277983, "text": "N-Acetylglutamate", "category": "All"}, {"x": 1.8217651735268607, "y": 3.46501620114364, "text": "Phenaceturate", "category": "All"}, {"x": -0.016489839828847254, "y": 0.07081618064019793, "text": "Glucuronate", "category": "All"}, {"x": 0.16019080666079522, "y": 0.4710936689481114, "text": "Dodecanoate", "category": "All"}, {"x": -0.5055156948877989, "y": 2.3227538622661736, "text": "Mucate", "category": "All"}, {"x": -0.6533495281986986, "y": 2.5092785917625906, "text": "3-Indoxyl sulfate", "category": "All"}, {"x": -0.8371452913920773, "y": 3.8382966722053125, "text": "Pantothenate", "category": "All"}, {"x": 0.24587138879119003, "y": 2.1114908371097796, "text": "N-Acetylglucosamine 1-phosphate", "category": "All"}, {"x": 0.14897974566588953, "y": 1.2366276670879457, "text": "N-Acetylglucosamine 6-phosphate", "category": "All"}, {"x": -0.04448089773059868, "y": 0.3235274677829936, "text": "CMP", "category": "All"}, {"x": 0.23805268214589329, "y": 1.744273653105473, "text": "UMP", "category": "All"}, {"x": 0.09211601218392158, "y": 0.6782234935350858, "text": "AMP", "category": "All"}, {"x": -0.00669209056461719, "y": 0.020413259758971042, "text": "IMP", "category": "All"}, {"x": -0.042478701332521476, "y": 0.2691791166244945, "text": "GMP", "category": "All"}, {"x": -0.018000078073418992, "y": 0.0686186257818486, "text": "CDP", "category": "All"}, {"x": 0.07668504532467163, "y": 0.3770611218485967, "text": "UDP", "category": "All"}, {"x": 0.48870240523741887, "y": 2.924417639575608, "text": "Isobutyryl CoA", "category": "All"}, {"x": 0.42620240853016683, "y": 2.0291031178555774, "text": "Adenosine 3',5'-diphosphate", "category": "All"}, {"x": 0.19067261742041824, "y": 1.8434490315402967, "text": "ADP", "category": "All"}, {"x": 0.12795731291658127, "y": 1.1790268000384558, "text": "GDP", "category": "All"}, {"x": -0.38056442672020285, "y": 2.3416587602742363, "text": "Adenylosuccinate", "category": "All"}, {"x": 0.16811543021629835, "y": 1.0349419128002697, "text": "CTP", "category": "All"}, {"x": 0.12149287588770298, "y": 0.6267121232791999, "text": "UTP", "category": "All"}, {"x": 0.4046240927618688, "y": 1.1015445595534845, "text": "ATP", "category": "All"}, {"x": 0.3214452467851169, "y": 1.2041819278896553, "text": "GTP", "category": "All"}, {"x": 0.10487951024629535, "y": 0.7825409376245336, "text": "CDP-choline", "category": "All"}, {"x": 0.013220731546854055, "y": 0.024383862725504756, "text": "ADP-ribose", "category": "All"}, {"x": -0.03204703790303398, "y": 0.20280911579326444, "text": "UDP-glucose", "category": "All"}, {"x": 0.12115358131287932, "y": 1.0136824079920903, "text": "UDP-glucuronate", "category": "All"}, {"x": 0.026435110118771324, "y": 0.1816980481500481, "text": "UDP-N-acetylglucosamine", "category": "All"}, {"x": -0.07937948258894202, "y": 0.5546797562419685, "text": "NAD+", "category": "All"}, {"x": -0.04161845817410368, "y": 0.20743673993641074, "text": "NADP+", "category": "All"}, {"x": -0.052392313649216204, "y": 0.29811942594156765, "text": "FAD", "category": "All"}, {"x": -0.28037887565392916, "y": 2.6334128824705068, "text": "Urea", "category": "All"}, {"x": -0.35234476635238987, "y": 4.747146969020107, "text": "Gly", "category": "All"}, {"x": -1.026611570944635, "y": 5.555955204081924, "text": "Trimethylamine N-oxide", "category": "All"}, {"x": -0.6870499095294184, "y": 1.9147445735675659, "text": "Putrescine(1,4-Butanediamine)", "category": "All"}, {"x": 0.16075895735609513, "y": 0.6568901479275379, "text": "beta-Ala", "category": "All"}, {"x": -0.33358010471943267, "y": 1.6421991573286325, "text": "Ala", "category": "All"}, {"x": -0.6092039764133028, "y": 1.9960097191876949, "text": "Sarcosine", "category": "All"}, {"x": -0.24886614396601342, "y": 0.49737953500481297, "text": "Betaine aldehyde", "category": "All"}, {"x": 0.16612773389935087, "y": 0.5855365657699354, "text": "Spermine", "category": "All"}, {"x": -0.34740432192255505, "y": 1.013394188962961, "text": "GABA", "category": "All"}, {"x": 0.7041334962170965, "y": 2.117373588395152, "text": "3-Aminoisobutyrate", "category": "All"}, {"x": 1.0046922281217388, "y": 2.391366048026337, "text": "2AB", "category": "All"}, {"x": -0.10466526121975994, "y": 0.29057898934337756, "text": "N,N-Dimethylglycine", "category": "All"}, {"x": 0.0038210549763808463, "y": 0.013621106902618356, "text": "Choline", "category": "All"}, {"x": -0.7241452355370187, "y": 5.297569463554475, "text": "Ser", "category": "All"}, {"x": 0.31991402044015377, "y": 0.4652264905907843, "text": "Diethanolamine", "category": "All"}, {"x": 0.028191409430156383, "y": 0.05327541751899239, "text": "beta-Ala-Lys", "category": "All"}, {"x": -1.9463189678129214, "y": 3.2758970631941207, "text": "Hypotaurine", "category": "All"}, {"x": 0.24245160661658796, "y": 0.8138762659555906, "text": "Histamine", "category": "All"}, {"x": -0.2784969259111512, "y": 0.9247520894294928, "text": "Carnosine", "category": "All"}, {"x": 0.6115364127272475, "y": 1.934282811565049, "text": "Creatinine", "category": "All"}, {"x": -0.9341122186603956, "y": 4.718966632752273, "text": "Pro", "category": "All"}, {"x": -0.6544443339801694, "y": 5.181774106386045, "text": "Guanidinoacetate", "category": "All"}, {"x": -0.40235244806422965, "y": 2.920251646259078, "text": "Val", "category": "All"}, {"x": -0.4587043042713475, "y": 0.9545621166177751, "text": "Betaine", "category": "All"}, {"x": -0.04039550684351142, "y": 0.18510900355913765, "text": "Homoserine", "category": "All"}, {"x": -0.5933836599637424, "y": 4.886056647693163, "text": "Thr", "category": "All"}, {"x": -0.6908632606980885, "y": 3.224555583964678, "text": "Anserine", "category": "All"}, {"x": -0.11510013431818336, "y": 0.3831512121327248, "text": "Nicotinamide", "category": "All"}, {"x": 0.021067769926295162, "y": 0.08151347827031341, "text": "Taurine", "category": "All"}, {"x": 0.5094634984048991, "y": 2.966045764262658, "text": "1-Methylhistamine", "category": "All"}, {"x": -0.1447834149394728, "y": 0.4806261850152255, "text": "Pipecolate", "category": "All"}, {"x": -0.9658542288894107, "y": 7.301029995663981, "text": "Hydroxyproline", "category": "All"}, {"x": 0.8027946550577384, "y": 6.278189384787454, "text": "Creatine", "category": "All"}, {"x": -0.16641678890935643, "y": 0.3501942086207776, "text": "6-Aminohexanoate", "category": "All"}, {"x": -0.24566818306668362, "y": 1.2018469515703147, "text": "Ile", "category": "All"}, {"x": -0.438930857001964, "y": 2.8619908261472387, "text": "Leu", "category": "All"}, {"x": -0.337737914990887, "y": 1.6846779923115967, "text": "Asn", "category": "All"}, {"x": -1.2051321546040918, "y": 4.804100347590766, "text": "Ornithine", "category": "All"}, {"x": -0.4016274478134471, "y": 3.0981870860022145, "text": "Asp", "category": "All"}, {"x": 0.017164205107739576, "y": 0.0555408499746621, "text": "Adenine", "category": "All"}, {"x": -0.2381234960407729, "y": 1.1421747925794719, "text": "Hypoxanthine", "category": "All"}, {"x": 0.4862714777271563, "y": 0.8386025895364752, "text": "1-Methylnicotinamide", "category": "All"}, {"x": -1.6723481254089103, "y": 7.675717544702307, "text": "Trigonelline", "category": "All"}, {"x": -1.4405278712121223, "y": 5.031984286006359, "text": "Proline betaine", "category": "All"}, {"x": -1.3032022384690534, "y": 5.375717904164332, "text": "gamma-Guanidinobutyrate", "category": "All"}, {"x": -0.6761481022615381, "y": 2.65853184116079, "text": "gamma-Butyrobetaine", "category": "All"}, {"x": 0.4304041472221999, "y": 2.7211808026769266, "text": "Spermidine", "category": "All"}, {"x": -0.6099921588047783, "y": 3.3525534553916794, "text": "Gln", "category": "All"}, {"x": -0.5454066744329317, "y": 4.723538195826756, "text": "Lys", "category": "All"}, {"x": -0.5216887262883488, "y": 6.42021640338319, "text": "Glu", "category": "All"}, {"x": -2.029132713727922, "y": 5.628932137728264, "text": "Met", "category": "All"}, {"x": -0.3940119649039822, "y": 3.7407861158148585, "text": "His", "category": "All"}, {"x": 0.8686496632478924, "y": 3.3257829739552536, "text": "N-Acetylvaline", "category": "All"}, {"x": -0.4608287925648183, "y": 0.9638309017660078, "text": "N-Methylglutamate", "category": "All"}, {"x": -0.4754895010776179, "y": 3.817768006516418, "text": "Carnitine", "category": "All"}, {"x": -0.7811700981497346, "y": 3.8391984474078344, "text": "5-Hydroxylysine", "category": "All"}, {"x": -1.335461200536931, "y": 5.476253533188435, "text": "Methionine sulfoxide", "category": "All"}, {"x": -0.34900411730670083, "y": 1.8653392837548697, "text": "Phe", "category": "All"}, {"x": -0.272548388398059, "y": 1.340622678279497, "text": "3-Methylhistidine", "category": "All"}, {"x": -0.6883619889706656, "y": 4.924453038607469, "text": "Arg", "category": "All"}, {"x": 0.688632706084388, "y": 3.4152380877024817, "text": "Guanidinosuccinate", "category": "All"}, {"x": -0.8016314260142701, "y": 4.841637507904751, "text": "Citrulline", "category": "All"}, {"x": -0.4009715837627075, "y": 0.614738306844138, "text": "Glucosamine", "category": "All"}, {"x": -0.8219346874241378, "y": 4.3535962737769305, "text": "Tyr", "category": "All"}, {"x": -0.7740501356100543, "y": 4.0762380391713, "text": "Phosphorylcholine", "category": "All"}, {"x": 1.1455474378984998, "y": 2.7047956599047653, "text": "N1-Acetylspermidine", "category": "All"}, {"x": -1.4039056066592521, "y": 6.102372908709558, "text": "N-epsilon-Acetyllysine", "category": "All"}, {"x": 0.4649459789311808, "y": 2.5361970133196667, "text": "N6,N6,N6-Trimethyllysine", "category": "All"}, {"x": -0.4700748014743097, "y": 4.06198090252379, "text": "SAH", "category": "All"}, {"x": -0.032069250139832126, "y": 0.08002862297031181, "text": "N-Acetylhistidine", "category": "All"}, {"x": -0.15170585034297643, "y": 1.2925737865764828, "text": "SAM+", "category": "All"}, {"x": -0.009137022059668182, "y": 0.05680989862531304, "text": "o-Acetylcarnitine", "category": "All"}, {"x": -0.7571055983379853, "y": 2.7718769390494638, "text": "Trp", "category": "All"}, {"x": -0.4867758648332902, "y": 2.866406169624125, "text": "Cysteine-glutathione disulphide", "category": "All"}, {"x": -0.06719503438744122, "y": 0.24316765400507198, "text": "N-Acetylglucosamine", "category": "All"}, {"x": -0.7108810080769171, "y": 3.5936574259265894, "text": "Cystathionine", "category": "All"}, {"x": -0.18725415757048222, "y": 1.8794771342989625, "text": "Cytidine", "category": "All"}, {"x": -0.13455010389088937, "y": 1.0647008473630775, "text": "Uridine", "category": "All"}, {"x": -0.16115852005815298, "y": 1.540333661322999, "text": "Pyridoxamine 5'-phosphate", "category": "All"}, {"x": 0.15866978854243352, "y": 0.6390078244519501, "text": "Glycerophosphorylcholine", "category": "All"}, {"x": -0.7338808081487929, "y": 3.63246145274579, "text": "Thiamine", "category": "All"}, {"x": -0.2752292418530644, "y": 2.3116836912509373, "text": "Adenosine", "category": "All"}, {"x": -0.32729137719756884, "y": 1.5613490832541854, "text": "Inosine", "category": "All"}, {"x": -1.0945079989581181, "y": 3.9153665347881197, "text": "Saccharopine", "category": "All"}, {"x": 0.7646898256597445, "y": 2.806106045983861, "text": "1-Methyladenosine", "category": "All"}, {"x": -0.42891833504683685, "y": 2.1988102653080004, "text": "Guanosine", "category": "All"}, {"x": 0.9220777190483654, "y": 2.0602448447939485, "text": "Ophthalmate", "category": "All"}, {"x": -0.36605702849740146, "y": 2.9629454013872785, "text": "Argininosuccinate", "category": "All"}, {"x": -0.0325629197258112, "y": 0.12395905434951107, "text": "5-Methylthioadenosine", "category": "All"}, {"x": -0.30739956570630367, "y": 3.227299184726672, "text": "Glutathione(ox)", "category": "All"}, {"x": -0.30788274859443, "y": 2.010884708990766, "text": "Thiamine monophosphate", "category": "All"}, {"x": -0.2989978523021491, "y": 1.7319793401455652, "text": "NMN", "category": "All"}, {"x": 0.24943051052935974, "y": 2.453284270112753, "text": "G1P", "category": "Upregulated"}, {"x": 0.40766081372749957, "y": 2.6076729699488026, "text": "3PG", "category": "Upregulated"}, {"x": 0.47308326168622755, "y": 2.568273349476041, "text": "PEP", "category": "Upregulated"}, {"x": 0.36508007862129094, "y": 2.039832621037868, "text": "Acetyl CoA", "category": "Upregulated"}, {"x": 0.5301642865760143, "y": 2.5871923237560126, "text": "Malonate", "category": "Upregulated"}, {"x": 0.7967715214748311, "y": 5.114073660198569, "text": "2-Hydroxyisobutyrate", "category": "Upregulated"}, {"x": 1.3173614589259295, "y": 2.2373101102601876, "text": "2-Hydroxybutyrate", "category": "Upregulated"}, {"x": 1.806187504534275, "y": 3.342339043758982, "text": "3-Hydroxybutyrate", "category": "Upregulated"}, {"x": 0.46238486801747863, "y": 2.6547315716583246, "text": "Hexanoate", "category": "Upregulated"}, {"x": 0.5927667273593937, "y": 2.9880187145344226, "text": "Isethionate", "category": "Upregulated"}, {"x": 0.5922538781072533, "y": 3.1895933957384335, "text": "Glutarate", "category": "Upregulated"}, {"x": 0.2582231373856632, "y": 2.6190281427060973, "text": "Ethanolamine phosphate", "category": "Upregulated"}, {"x": 0.8387458382373921, "y": 3.0130259405957247, "text": "Citramalate", "category": "Upregulated"}, {"x": 0.4035976990450824, "y": 1.9838096755880816, "text": "Pelargonate", "category": "Upregulated"}, {"x": 0.9805804221995871, "y": 3.8817220435109245, "text": "3-Hydroxy-3-methylglutarate", "category": "Upregulated"}, {"x": 1.8217651735268607, "y": 3.46501620114364, "text": "Phenaceturate", "category": "Upregulated"}, {"x": 0.24587138879119003, "y": 2.1114908371097796, "text": "N-Acetylglucosamine 1-phosphate", "category": "Upregulated"}, {"x": 0.23805268214589329, "y": 1.744273653105473, "text": "UMP", "category": "Upregulated"}, {"x": 0.48870240523741887, "y": 2.924417639575608, "text": "Isobutyryl CoA", "category": "Upregulated"}, {"x": 0.42620240853016683, "y": 2.0291031178555774, "text": "Adenosine 3',5'-diphosphate", "category": "Upregulated"}, {"x": 0.19067261742041824, "y": 1.8434490315402967, "text": "ADP", "category": "Upregulated"}, {"x": 0.7041334962170965, "y": 2.117373588395152, "text": "3-Aminoisobutyrate", "category": "Upregulated"}, {"x": 1.0046922281217388, "y": 2.391366048026337, "text": "2AB", "category": "Upregulated"}, {"x": 0.6115364127272475, "y": 1.934282811565049, "text": "Creatinine", "category": "Upregulated"}, {"x": 0.5094634984048991, "y": 2.966045764262658, "text": "1-Methylhistamine", "category": "Upregulated"}, {"x": 0.8027946550577384, "y": 6.278189384787454, "text": "Creatine", "category": "Upregulated"}, {"x": 0.4304041472221999, "y": 2.7211808026769266, "text": "Spermidine", "category": "Upregulated"}, {"x": 0.8686496632478924, "y": 3.3257829739552536, "text": "N-Acetylvaline", "category": "Upregulated"}, {"x": 0.688632706084388, "y": 3.4152380877024817, "text": "Guanidinosuccinate", "category": "Upregulated"}, {"x": 1.1455474378984998, "y": 2.7047956599047653, "text": "N1-Acetylspermidine", "category": "Upregulated"}, {"x": 0.4649459789311808, "y": 2.5361970133196667, "text": "N6,N6,N6-Trimethyllysine", "category": "Upregulated"}, {"x": 0.7646898256597445, "y": 2.806106045983861, "text": "1-Methyladenosine", "category": "Upregulated"}, {"x": 0.9220777190483654, "y": 2.0602448447939485, "text": "Ophthalmate", "category": "Upregulated"}, {"x": -0.36503884058404573, "y": 2.5409715371860067, "text": "Lactate", "category": "Downregulated"}, {"x": -0.47097849050548535, "y": 2.667302454673457, "text": "Citrate", "category": "Downregulated"}, {"x": -0.37397262773901424, "y": 1.8052144267199037, "text": "cis-Aconitate", "category": "Downregulated"}, {"x": -0.3990486960309522, "y": 2.033197984525177, "text": "Cysteine sulfinate", "category": "Downregulated"}, {"x": -1.3744180380985593, "y": 6.782516055786093, "text": "3-(4-Hydroxyphenyl)propionate", "category": "Downregulated"}, {"x": -0.7802892291281919, "y": 1.8217223981810846, "text": "Urate", "category": "Downregulated"}, {"x": -0.6593265921933185, "y": 5.09312646527793, "text": "Cysteate", "category": "Downregulated"}, {"x": -1.4469233761934235, "y": 3.6546596025764764, "text": "N-Acetylleucine", "category": "Downregulated"}, {"x": -0.5055156948877989, "y": 2.3227538622661736, "text": "Mucate", "category": "Downregulated"}, {"x": -0.6533495281986986, "y": 2.5092785917625906, "text": "3-Indoxyl sulfate", "category": "Downregulated"}, {"x": -0.8371452913920773, "y": 3.8382966722053125, "text": "Pantothenate", "category": "Downregulated"}, {"x": -0.38056442672020285, "y": 2.3416587602742363, "text": "Adenylosuccinate", "category": "Downregulated"}, {"x": -0.28037887565392916, "y": 2.6334128824705068, "text": "Urea", "category": "Downregulated"}, {"x": -0.35234476635238987, "y": 4.747146969020107, "text": "Gly", "category": "Downregulated"}, {"x": -1.026611570944635, "y": 5.555955204081924, "text": "Trimethylamine N-oxide", "category": "Downregulated"}, {"x": -0.6870499095294184, "y": 1.9147445735675659, "text": "Putrescine(1,4-Butanediamine)", "category": "Downregulated"}, {"x": -0.6092039764133028, "y": 1.9960097191876949, "text": "Sarcosine", "category": "Downregulated"}, {"x": -0.7241452355370187, "y": 5.297569463554475, "text": "Ser", "category": "Downregulated"}, {"x": -1.9463189678129214, "y": 3.2758970631941207, "text": "Hypotaurine", "category": "Downregulated"}, {"x": -0.9341122186603956, "y": 4.718966632752273, "text": "Pro", "category": "Downregulated"}, {"x": -0.6544443339801694, "y": 5.181774106386045, "text": "Guanidinoacetate", "category": "Downregulated"}, {"x": -0.40235244806422965, "y": 2.920251646259078, "text": "Val", "category": "Downregulated"}, {"x": -0.5933836599637424, "y": 4.886056647693163, "text": "Thr", "category": "Downregulated"}, {"x": -0.6908632606980885, "y": 3.224555583964678, "text": "Anserine", "category": "Downregulated"}, {"x": -0.9658542288894107, "y": 7.301029995663981, "text": "Hydroxyproline", "category": "Downregulated"}, {"x": -0.438930857001964, "y": 2.8619908261472387, "text": "Leu", "category": "Downregulated"}, {"x": -1.2051321546040918, "y": 4.804100347590766, "text": "Ornithine", "category": "Downregulated"}, {"x": -0.4016274478134471, "y": 3.0981870860022145, "text": "Asp", "category": "Downregulated"}, {"x": -1.6723481254089103, "y": 7.675717544702307, "text": "Trigonelline", "category": "Downregulated"}, {"x": -1.4405278712121223, "y": 5.031984286006359, "text": "Proline betaine", "category": "Downregulated"}, {"x": -1.3032022384690534, "y": 5.375717904164332, "text": "gamma-Guanidinobutyrate", "category": "Downregulated"}, {"x": -0.6761481022615381, "y": 2.65853184116079, "text": "gamma-Butyrobetaine", "category": "Downregulated"}, {"x": -0.6099921588047783, "y": 3.3525534553916794, "text": "Gln", "category": "Downregulated"}, {"x": -0.5454066744329317, "y": 4.723538195826756, "text": "Lys", "category": "Downregulated"}, {"x": -0.5216887262883488, "y": 6.42021640338319, "text": "Glu", "category": "Downregulated"}, {"x": -2.029132713727922, "y": 5.628932137728264, "text": "Met", "category": "Downregulated"}, {"x": -0.3940119649039822, "y": 3.7407861158148585, "text": "His", "category": "Downregulated"}, {"x": -0.4754895010776179, "y": 3.817768006516418, "text": "Carnitine", "category": "Downregulated"}, {"x": -0.7811700981497346, "y": 3.8391984474078344, "text": "5-Hydroxylysine", "category": "Downregulated"}, {"x": -1.335461200536931, "y": 5.476253533188435, "text": "Methionine sulfoxide", "category": "Downregulated"}, {"x": -0.34900411730670083, "y": 1.8653392837548697, "text": "Phe", "category": "Downregulated"}, {"x": -0.6883619889706656, "y": 4.924453038607469, "text": "Arg", "category": "Downregulated"}, {"x": -0.8016314260142701, "y": 4.841637507904751, "text": "Citrulline", "category": "Downregulated"}, {"x": -0.8219346874241378, "y": 4.3535962737769305, "text": "Tyr", "category": "Downregulated"}, {"x": -0.7740501356100543, "y": 4.0762380391713, "text": "Phosphorylcholine", "category": "Downregulated"}, {"x": -1.4039056066592521, "y": 6.102372908709558, "text": "N-epsilon-Acetyllysine", "category": "Downregulated"}, {"x": -0.4700748014743097, "y": 4.06198090252379, "text": "SAH", "category": "Downregulated"}, {"x": -0.7571055983379853, "y": 2.7718769390494638, "text": "Trp", "category": "Downregulated"}, {"x": -0.4867758648332902, "y": 2.866406169624125, "text": "Cysteine-glutathione disulphide", "category": "Downregulated"}, {"x": -0.7108810080769171, "y": 3.5936574259265894, "text": "Cystathionine", "category": "Downregulated"}, {"x": -0.18725415757048222, "y": 1.8794771342989625, "text": "Cytidine", "category": "Downregulated"}, {"x": -0.7338808081487929, "y": 3.63246145274579, "text": "Thiamine", "category": "Downregulated"}, {"x": -0.2752292418530644, "y": 2.3116836912509373, "text": "Adenosine", "category": "Downregulated"}, {"x": -1.0945079989581181, "y": 3.9153665347881197, "text": "Saccharopine", "category": "Downregulated"}, {"x": -0.42891833504683685, "y": 2.1988102653080004, "text": "Guanosine", "category": "Downregulated"}, {"x": -0.36605702849740146, "y": 2.9629454013872785, "text": "Argininosuccinate", "category": "Downregulated"}, {"x": -0.30739956570630367, "y": 3.227299184726672, "text": "Glutathione(ox)", "category": "Downregulated"}, {"x": -0.30788274859443, "y": 2.010884708990766, "text": "Thiamine monophosphate", "category": "Downregulated"}, {"x": -0.2989978523021491, "y": 1.7319793401455652, "text": "NMN", "category": "Downregulated"}];
        var plotDiv = document.getElementById('plotly-div');

        // Populate gene selector dropdown
        populateGeneSelector();

        // Initial plot
        var traces = createTraces(allData);
        var layout = {
            title: 'Differentially regulated metabolites',
            xaxis: {
                title: 'log<sub>2</sub> FC',
                range: [-10, 10]
            },
            yaxis: {
                title: '-log<sub>10</sub> P-value'
            },
            hovermode: 'closest',
            template: 'plotly_white',

            // Prevent auto-grouping in legend (fixes "Aa" issue)
            uirevision: 'true',

            legend: {
                yanchor: "top",
                y: 0.99,
                xanchor: "left",
                x: 0.01,
                title: { text: '' },
                font: { size: 12 },
                tracegroupgap: 0  // Remove trace grouping
            },

            // Default to pan mode instead of zoom
            dragmode: 'pan',

            // Initialize empty annotations array
            annotations: []
        };

        // Add horizontal line
        layout.shapes = [{
            type: 'line',
            x0: 0,
            x1: 30,
            y0: 0,
            y1: 0,
            line: {
                color: 'black',
                width: 1,
                dash: 'dash'
            }
        }];

        // Configure
        var config = {
            responsive: true,
            scrollZoom: true,  // Enable scroll to zoom
            displayModeBar: true,
            modeBarButtonsToAdd: [
                'drawline',
                'drawopenpath',
                'drawclosedpath',
                'drawcircle',
                'drawrect',
                'eraseshape'
            ],
            dragmode: 'pan'  // Enable panning by default
        };

        Plotly.newPlot(plotDiv, traces, layout, config);

        // Add click event to show gene names on demand
        plotDiv.on('plotly_click', function(data) {
            if (data.points && data.points.length > 0) {
                var point = data.points[0];
                var geneName = point.text;
                var x = point.x;
                var y = point.y;

                // Add annotation for the clicked point
                var annotations = [{
                    x: x,
                    y: y,
                    xref: 'x',
                    yref: 'y',
                    text: geneName,
                    showarrow: true,
                    arrowhead: 2,
                    arrowsize: 1,
                    arrowwidth: 2,
                    arrowcolor: '#FF0000',
                    ax: 0,
                    ay: -40,
                    bordercolor: '#FF0000',
                    borderwidth: 2,
                    borderpad: 4,
                    bgcolor: '#FFFFFF',
                    opacity: 1
                }];

                Plotly.relayout(plotDiv, { annotations: annotations });
            }
        });

        // Add click event on the main plot to clear annotations
        plotDiv.on('plotly_relayout', function(eventdata) {
            // Only clear annotations if the user is panning or zooming
            if (eventdata['dragmode'] ||
                eventdata['xaxis.range[0]'] !== undefined ||
                eventdata['yaxis.range[0]'] !== undefined) {
                // Keep annotations during normal interactions
                return;
            }

            // Clear annotations if clicking on empty areas
            if (!eventdata.annotations) {
                Plotly.relayout(plotDiv, { annotations: [] });
            }
        });

        // Function to populate gene selector dropdown
        function populateGeneSelector() {
            var geneSelector = document.getElementById('gene-selector');
            var uniqueGenes = new Set();

            // Add upregulated and downregulated genes to the dropdown
            allData.forEach(gene => {
                if (gene.category === 'Upregulated' || gene.category === 'Downregulated') {
                    if (!uniqueGenes.has(gene.text)) {
                        uniqueGenes.add(gene.text);
                        var option = document.createElement('option');
                        option.value = gene.text;
                        option.text = gene.text + (gene.category === 'Upregulated' ? ' (Up)' : ' (Down)');
                        geneSelector.appendChild(option);
                    }
                }
            });

            // Sort dropdown options alphabetically
            var options = Array.from(geneSelector.options).slice(1); // Skip the first "Select a gene" option
            options.sort((a, b) => a.text.localeCompare(b.text));

            // Clear and re-add the options
            while (geneSelector.options.length > 1) {
                geneSelector.remove(1);
            }

            options.forEach(option => geneSelector.add(option));
        }

        // Function to create traces
        function createTraces(data) {
            var traces = [];

            // Filter by category
            var showAll = document.getElementById('filter-all').checked;
            var showUp = document.getElementById('filter-up').checked;
            var showDown = document.getElementById('filter-down').checked;

            // All genes (gray) - no text labels by default
            if (showAll) {
                var allGenes = data.filter(d => d.category === 'All');
                traces.push({
                    x: allGenes.map(d => d.x),
                    y: allGenes.map(d => d.y),
                    mode: 'markers',  // Only markers, no text
                    marker: {
                        color: 'gray',
                        size: 3,
                        opacity: 0.3
                    },
                    text: allGenes.map(d => d.text),
                    name: 'All metabolites',
                    hovertemplate: '<b>%{text}</b><br>log2FC: %{x:.2f}<br>-log10P: %{y:.2f}<extra></extra>',
                    showlegend: true,
                    legendgroup: null
                });
            }

            // Upregulated metabolites (cyan) - no text labels by default
            if (showUp) {
                var upGenes = data.filter(d => d.category === 'Upregulated');
                traces.push({
                    x: upGenes.map(d => d.x),
                    y: upGenes.map(d => d.y),
                    mode: 'markers',  // Only markers, no text
                    marker: {
                        color: 'blue',
                        size: 5,
                        opacity: 1
                    },
                    text: upGenes.map(d => d.text),
                    name: 'Upregulated metabolites',
                    hovertemplate: '<b>%{text}</b><br>log2FC: %{x:.2f}<br>-log10P: %{y:.2f}<extra></extra>',
                    showlegend: true,
                    legendgroup: null
                });
            }

            // Downregulated metabolites (green) - no text labels by default
            if (showDown) {
                var downGenes = data.filter(d => d.category === 'Downregulated');
                traces.push({
                    x: downGenes.map(d => d.x),
                    y: downGenes.map(d => d.y),
                    mode: 'markers',  // Only markers, no text
                    marker: {
                        color: 'red',
                        size: 5,
                        opacity: 1
                    },
                    text: downGenes.map(d => d.text),
                    name: 'Downregulated metabolites',
                    hovertemplate: '<b>%{text}</b><br>log2FC: %{x:.2f}<br>-log10P: %{y:.2f}<extra></extra>',
                    showlegend: true,
                    legendgroup: null
                });
            }

            return traces;
        }

        // Function to update filters
        function updateFilters() {
            var traces = createTraces(allData);
            Plotly.react(plotDiv, traces, layout, config);
        }

        // Function to select gene from dropdown
        function selectGene(geneName) {
            if (geneName) {
                zoomToGene(geneName);
            } else {
                // Clear annotations if no gene is selected
                Plotly.relayout(plotDiv, { annotations: [] });
            }
        }

        // Function to search for genes
        function searchGene() {
            var searchTerm = document.getElementById('gene-search').value.trim().toLowerCase();
            var resultsDiv = document.getElementById('search-results');

            if (!searchTerm) {
                resultsDiv.innerHTML = '';
                return;
            }

            // Find genes matching the search term
            var matchingGenes = allData.filter(d =>
                d.text.toLowerCase().includes(searchTerm)
            );

            // Remove duplicates
            var uniqueGenes = [];
            var uniqueTexts = new Set();

            matchingGenes.forEach(gene => {
                if (!uniqueTexts.has(gene.text)) {
                    uniqueTexts.add(gene.text);
                    uniqueGenes.push(gene);
                }
            });

            // Display results
            if (uniqueGenes.length > 0) {
                resultsDiv.innerHTML = `<p>Found ${uniqueGenes.length} matching genes:</p>`;

                // Limit display if too many matches
                var displayLimit = 20;
                var displayGenes = uniqueGenes.slice(0, displayLimit);

                // Create annotations for all matching genes
                var annotations = [];

                // Debug log
                console.log("Creating annotations for " + displayGenes.length + " genes");

                // Calculate bounds for zoom
                var minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;

                displayGenes.forEach(gene => {
                    // Update bounds for zoom
                    minX = Math.min(minX, gene.x);
                    maxX = Math.max(maxX, gene.x);
                    minY = Math.min(minY, gene.y);
                    maxY = Math.max(maxY, gene.y);

                    // Create annotation for each gene
                    var annotation = {
                        x: gene.x,
                        y: gene.y,
                        xref: 'x',
                        yref: 'y',
                        text: gene.text,
                        showarrow: true,
                        arrowhead: 2,
                        arrowsize: 1,
                        arrowwidth: 2,
                        arrowcolor: '#FF0000',
                        ax: 0,
                        ay: -40,
                        bordercolor: '#FF0000',
                        borderwidth: 2,
                        borderpad: 4,
                        bgcolor: '#FFFFFF',
                        opacity: 0.9
                    };
                    annotations.push(annotation);

                    // Debug log
                    console.log("Added annotation for " + gene.text + " at position " + gene.x + ", " + gene.y);
                });

                // Add padding to zoom area
                const padding = 2;
                minX = Math.max(0, minX - padding);
                maxX = maxX + padding;
                minY = minY - padding;
                maxY = maxY + padding;

                // Make sure we have the right annotations structure
                if (!layout) {
                    console.error("Layout is not defined!");
                    layout = {};
                }

                // Prepare update with zoom and annotations
                var update = {
                    annotations: annotations,
                    xaxis: {
                        range: [minX, maxX]
                    },
                    yaxis: {
                        range: [minY, maxY]
                    }
                };

                // Apply annotations and zoom to show all matching genes
                try {
                    Plotly.relayout(plotDiv, update);
                    console.log("Successfully added annotations and zoomed to view all matching genes");
                } catch (error) {
                    console.error("Error applying annotations and zoom:", error);

                    // Fallback method
                    try {
                        // First update the layout object
                        layout.annotations = annotations;
                        layout.xaxis.range = [minX, maxX];
                        layout.yaxis.range = [minY, maxY];

                        // Then apply the full layout update
                        Plotly.relayout(plotDiv, layout);
                        console.log("Applied annotations and zoom using fallback method");
                    } catch (fallbackError) {
                        console.error("Fallback method also failed:", fallbackError);
                    }
                }

                var geneList = displayGenes.map(gene =>
                    `<a href="#" onclick="zoomToGene('${gene.text}'); return false;">${gene.text}</a>`
                ).join(', ');

                if (uniqueGenes.length > displayLimit) {
                    resultsDiv.innerHTML += `<p>${geneList}, ... (and ${uniqueGenes.length - displayLimit} more)</p>`;
                } else {
                    resultsDiv.innerHTML += `<p>${geneList}</p>`;
                }
            } else {
                resultsDiv.innerHTML = '<p>No matching genes found.</p>';
            }
        }

        // Function to zoom to a specific gene
        function zoomToGene(geneName) {
            console.log("Zooming to gene: " + geneName);

            // Reset selector if called from search
            if (document.getElementById('gene-selector').value !== geneName) {
                document.getElementById('gene-selector').value = geneName;
            }

            // Find the gene
            var geneData = allData.find(d => d.text === geneName);

            if (geneData) {
                console.log("Found gene data:", geneData);

                // Get coordinates
                var x = geneData.x;
                var y = geneData.y;

                // Zoom to the point with some padding
                var updateLayout = {
                    xaxis: { range: [x - 2, x + 2] },
                    yaxis: { range: [y - 2, y + 2] }
                };

                // Create red arrow annotation pointing clearly at the gene
                var annotations = [{
                    x: x,
                    y: y,
                    xref: 'x',
                    yref: 'y',
                    text: geneName,
                    showarrow: true,
                    arrowhead: 3,
                    arrowsize: 1,
                    arrowwidth: 3,
                    arrowcolor: '#FF0000',
                    ax: 0,
                    ay: -60,
                    bordercolor: '#FF0000',
                    borderwidth: 2,
                    borderpad: 4,
                    bgcolor: '#FFFFFF',
                    opacity: 0.9
                }];

                updateLayout.annotations = annotations;

                // Apply annotations and zoom to plot
                Plotly.relayout(plotDiv, updateLayout);

                // Reset the selector dropdown if needed
                if (document.getElementById('gene-selector').value !== geneName) {
                    document.getElementById('gene-selector').value = geneName;
                }
            } else {
                alert("Gene not found!");
            }
        }

        // Function to reset view
        function resetView() {
            // Clear search box and selector
            document.getElementById('gene-search').value = '';
            document.getElementById('gene-selector').value = '';
            document.getElementById('search-results').innerHTML = '';

            // Reset zoom
            var resetLayout = {
                xaxis: {
                    range: [-20, 20]
                },
                yaxis: {
                    autorange: true
                },
                annotations: []
            };

            Plotly.relayout(plotDiv, resetLayout);
        }
    </script>
</body>
</html>
